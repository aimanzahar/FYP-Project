<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HardwareForge - GPUs</title>
  <link rel="stylesheet" href="public/css/bootstrap.min.css" />
  <link rel="stylesheet" href="public/css/dropdown.css" />
  <link rel="stylesheet" href="public/css/gpu.css" />
</head>
<body class="dark">
  <div class="wrapper">
    <aside id="sidebar-container" class="sidebar"></aside>
    <main class="main-content flex-grow-1 py-5">
      <div class="flex-container py-5">
        <div class="container-fluid">
          <h2 class="text-center mb-4">Select Your Graphics Cards</h2>
          <div class="row">
            <div id="gpu-grid" class="column"></div>
          </div>
          <div id="pagination-container" class="mt-4 text-center"></div>
        </div>
      </div>
    </main>
  </div>
  <div id="dropdown-container"></div>
  <script>
    const itemsPerPage = 15;
    let gpus = [];

    function renderList(page = 1) {
      const start = (page - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const currentItems = gpus.slice(start, end);

      const grid = document.getElementById("gpu-grid");
      grid.innerHTML = ""; // Clear previous cards

      currentItems.forEach(gpu => {
        const col = document.createElement("div");
        col.className = "gpu-col";

        // Handle image URL properly (support both local & full URLs)
        const imageUrl = gpu.image_url?.startsWith("http")
          ? gpu.image_url
          : `/images/${gpu.image_url?.replace(/^images[\\/]/, "")}`;

        col.innerHTML = `
          <div class="gpu-card text-center shadow-sm p-3 mb-4 rounded">
            <img src="${imageUrl}" alt="${gpu.name}" width="250" class="mb-2">
            <h6 class="fw-semibold">${gpu.name}</h6>
            <p class="text-success fw-bold">RM ${parseFloat(gpu.price).toFixed(2)}</p>
            <button class="btn btn-sm btn-primary add-button">Add</button>
          </div>
        `;

        col.querySelector('.add-button').addEventListener('click', () => {
          const selectedGPU = {
            name: gpu.name,
            price: parseFloat(gpu.price),
            image_url: gpu.image_url
          };
          localStorage.setItem('selectedGPU', JSON.stringify(selectedGPU));
          window.location.href = 'build.html';
        });

        grid.appendChild(col);
      });
    }

    function renderPagination(totalItems, currentPage = 1) {
      const totalPages = Math.ceil(totalItems / itemsPerPage);
      const container = document.getElementById("pagination-container");
      container.innerHTML = "";

      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement("button");
        btn.className = `btn mx-1 ${i === currentPage ? "btn-primary" : "btn-outline-primary"}`;
        btn.textContent = i;
        btn.onclick = () => {
          renderList(i);
          renderPagination(totalItems, i);
        };
        container.appendChild(btn);
      }
    }

    fetch('http://localhost:3001/api/gpus')
      .then(res => res.json())
      .then(data => {
        gpus = data;
        if (gpus.length > 0) {
          renderList();
          renderPagination(gpus.length);
        } else {
          document.getElementById("gpu-grid").innerHTML =
            "<p class='text-center text-muted'>No GPUs found.</p>";
        }
      })
      .catch(err => {
        console.error('‚ùå Error fetching GPU data:', err);
        document.getElementById("gpu-grid").innerHTML =
          "<p class='text-center text-danger'>Failed to load GPUs.</p>";
      });
  </script>

  <script src="public/js/bootstrap.bundle.min.js"></script>
  <script src="public/js/common.js"></script>
</body>
</html>
